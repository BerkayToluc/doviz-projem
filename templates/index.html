<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Berkay Finans Terminali</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.0.0/css/flag-icons.min.css"/>
    <style>
        body { background-color: #000000; color: #FFFFFF; font-family: 'Segoe UI', sans-serif; }
        .card { background-color: #121212; border: 1px solid #333; border-radius: 15px; margin-bottom: 20px; transition: 0.3s; }
        .text-bright { color: #FFFFFF !important; font-weight: 600; }
        .price-tag { font-size: 1.6rem; font-weight: bold; color: #00FF41; text-shadow: 0 0 5px #00FF41; transition: 0.5s; }
        .header-title { color: #FFD700; text-transform: uppercase; letter-spacing: 2px; border-bottom: 2px solid #FFD700; display: inline-block; padding-bottom: 5px; }
        .update-flash { color: #ffffff !important; text-shadow: 0 0 15px #ffffff; }
    </style>
</head>
<body class="p-4">
    <div class="container">
        <div class="text-center mb-5">
            <h1 class="header-title">Berkay Finans Terminali</h1>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="card p-4 shadow">
                    <h3 class="text-bright mb-3">üí± D√∂viz Hesapla</h3>
                    <form method="POST">
                        <input type="hidden" name="form_tipi" value="doviz">
                        <input type="number" step="0.01" name="miktar" class="form-control mb-3 bg-dark text-white border-secondary" placeholder="Miktar Giriniz">
                        <select name="birim" class="form-select mb-3 bg-dark text-white border-secondary">
                            <option value="USD">Dolar (USD)</option>
                            <option value="EUR">Euro (EUR)</option>
                            <option value="GBP">Sterlin (GBP)</option>
                            <option value="JPY">Japon Yeni (JPY)</option>
                            <option value="PLN">Polonya Zlotisi (PLN)</option>
                        </select>
                        <button type="submit" class="btn btn-primary w-100 fw-bold">TL'YE √áEVƒ∞R</button>
                    </form>
                    {% if doviz_sonuc %}<div class="alert alert-info mt-3 bg-primary text-white border-0">{{ miktar }} {{ birim }} = {{ doviz_sonuc }} TL</div>{% endif %}
                </div>

                <div class="card p-4 shadow">
                    <h3 class="text-bright mb-3 text-warning">‚ú® Altƒ±n Hesapla</h3>
                    <form method="POST">
                        <input type="hidden" name="form_tipi" value="altin">
                        <input type="number" step="0.01" name="altin_miktari" class="form-control mb-3 bg-dark text-white border-secondary" placeholder="Gram Miktarƒ±">
                        <select name="altin_turu" class="form-select mb-3 bg-dark text-white border-secondary">
                            <option value="GRAM">Gram Altƒ±n</option>
                        </select>
                        <button type="submit" class="btn btn-warning w-100 fw-bold">HESAPLA</button>
                    </form>
                    {% if altin_sonuc %}<div class="alert alert-warning mt-3 bg-warning text-dark border-0">Toplam: {{ altin_sonuc }} TL</div>{% endif %}
                </div>
            </div>

            <div class="col-md-6">
                <h3 class="text-bright mb-3">üìà Canlƒ± Piyasa Verileri</h3>
                {% for kod, isim, bayrak in [('USD','USD / TRY','us'), ('EUR','EUR / TRY','eu'), ('GBP','GBP / TRY','gb'), ('JPY','JPY / TRY','jp'), ('PLN','PLN / TRY','pl')] %}
                <div class="card p-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="text-bright fs-5"><span class="fi fi-{{bayrak}} me-2"></span> {{isim}}</span>
                        <span class="price-tag" id="val-{{kod}}">{{ kurlar[kod] }} ‚Ç∫</span>
                    </div>
                </div>
                {% endfor %}

                <div class="card p-3 border-warning">
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="text-warning fs-5">üèÜ Gram Altƒ±n</span>
                        <span class="price-tag" id="val-GRAM" style="color: #FFD700; text-shadow: 0 0 5px #FFD700;">{{ altin_fiyatlari.GRAM }} ‚Ç∫</span>
                    </div>
                </div>
                <div class="card p-3 border-info">
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="text-info fs-5">üåç Ons Altƒ±n (XAU)</span>
                        <span class="price-tag" id="val-ONS" style="color: #00D1FF; text-shadow: 0 0 5px #00D1FF;">${{ altin_fiyatlari.ONS }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function guncelle() {
            fetch('/api/fiyatlar')
                .then(r => r.json())
                .then(data => {
                    const sync = (id, val, suffix) => {
                        let el = document.getElementById('val-' + id);
                        if(el && el.innerText !== val + suffix) {
                            el.innerText = val + suffix;
                            el.classList.add('update-flash');
                            setTimeout(() => el.classList.remove('update-flash'), 600);
                        }
                    }
                    sync('USD', data.kurlar.USD, " ‚Ç∫");
                    sync('EUR', data.kurlar.EUR, " ‚Ç∫");
                    sync('GBP', data.kurlar.GBP, " ‚Ç∫");
                    sync('JPY', data.kurlar.JPY, " ‚Ç∫");
                    sync('PLN', data.kurlar.PLN, " ‚Ç∫");
                    sync('GRAM', data.altin.GRAM, " ‚Ç∫");
                    sync('ONS', data.altin.ONS, "");
                });
        }
        setInterval(guncelle, 10000);
    </script>
</body>
</html>