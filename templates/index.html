<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Berkay Finans Terminali</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.0.0/css/flag-icons.min.css"/>
    <style>
        body { background-color: #000000; color: #FFFFFF; font-family: 'Segoe UI', sans-serif; }
        .card { background-color: #121212; border: 1px solid #333; border-radius: 15px; margin-bottom: 20px; }
        .text-bright { color: #FFFFFF !important; font-weight: 600; }
        .price-tag { font-size: 1.4rem; font-weight: bold; color: #FFFFFF; }
        .header-title { color: #FFD700; text-transform: uppercase; letter-spacing: 2px; border-bottom: 2px solid #FFD700; display: inline-block; padding-bottom: 5px; }
        .loading-text { font-size: 0.9rem; color: #888; }
    </style>
</head>
<body class="p-4">
    <div class="container">
        <div class="text-center mb-5">
            <h1 class="header-title">Berkay Finans Terminali</h1>
        </div>

        <div class="row">
            <div class="col-md-5">
                <div class="card p-4 shadow mb-4">
                    <h3 class="text-bright mb-3">üí± D√∂viz Hesapla</h3>
                    <input type="number" id="calc-miktar" class="form-control mb-3 bg-dark text-white border-secondary" placeholder="Miktar">
                    <select id="calc-birim" class="form-select mb-3 bg-dark text-white border-secondary">
                        <option value="USD">Dolar (USD)</option>
                        <option value="EUR">Euro (EUR)</option>
                    </select>
                    <button class="btn btn-primary w-100 fw-bold" onclick="calcDoviz()">HESAPLA</button>
                    <div id="doviz-sonuc-box" class="alert alert-primary mt-3 border-0" style="display:none;"><span id="doviz-sonuc-text"></span></div>
                </div>

                <div class="card p-4 shadow">
                    <h3 class="text-bright mb-3 text-warning">‚ú® Altƒ±n Hesapla</h3>
                    <input type="number" id="calc-altin-miktar" class="form-control mb-3 bg-dark text-white border-secondary" placeholder="Adet/Gram">
                    <select id="calc-altin-turu" class="form-select mb-3 bg-dark text-white border-secondary">
                        <option value="GRAM">Gram Altƒ±n</option>
                        <option value="CEYREK">√áeyrek Altƒ±n</option>
                        <option value="YARIM">Yarƒ±m Altƒ±n</option>
                        <option value="TAM">Tam Altƒ±n</option>
                    </select>
                    <button class="btn btn-warning w-100 fw-bold" onclick="calcAltin()">HESAPLA</button>
                    <div id="altin-sonuc-box" class="alert alert-warning mt-3 border-0" style="display:none;"><span id="altin-sonuc-text"></span></div>
                </div>
            </div>

            <div class="col-md-7">
                <h3 class="text-bright mb-3">üìà Canlƒ± Piyasa</h3>
                <div class="row">
                    {% for kod, isim in [('USD','Dolar'),('EUR','Euro'),('GRAM','Gram Altƒ±n'),('CEYREK','√áeyrek'),('YARIM','Yarƒ±m'),('TAM','Tam Altƒ±n')] %}
                    <div class="col-6">
                        <div class="card p-3 mb-2">
                            <div class="small text-secondary">{{isim}}</div>
                            <div class="price-tag" id="val-{{kod}}"><span class="loading-text">‚è≥ Bekleniyor...</span></div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <script>
        function temizleVeSayiyaCevir(text) {
            if (!text || text.includes("Bekleniyor")) return 0;
            // T√ºm noktalarƒ± sil, virg√ºl√º noktaya √ßevir
            let temiz = text.toString().replace(/[‚Ç∫$\s]/g, '').replace(/\./g, '').replace(',', '.').trim();
            return parseFloat(temiz) || 0;
        }

        function calcDoviz() {
            let m = document.getElementById('calc-miktar').value;
            let b = document.getElementById('calc-birim').value;
            let kur = temizleVeSayiyaCevir(document.getElementById('val-' + b).textContent);
            if (kur > 0 && m) {
                let s = m * kur;
                document.getElementById('doviz-sonuc-text').innerText = m + " " + b + " = " + s.toLocaleString('tr-TR') + " TL";
                document.getElementById('doviz-sonuc-box').style.display = 'block';
            }
        }

        function calcAltin() {
            let m = document.getElementById('calc-altin-miktar').value;
            let t = document.getElementById('calc-altin-turu').value;
            let fiyat = temizleVeSayiyaCevir(document.getElementById('val-' + t).textContent);
            if (fiyat > 0 && m) {
                let s = m * fiyat;
                document.getElementById('altin-sonuc-text').innerText = m + " Adet = " + s.toLocaleString('tr-TR') + " TL";
                document.getElementById('altin-sonuc-box').style.display = 'block';
            }
        }

        function guncelle() {
            fetch('/api/fiyatlar').then(r => r.json()).then(data => {
                const v = {...data.kurlar, ...data.altin};
                Object.keys(v).forEach(k => {
                    let el = document.getElementById('val-' + k);
                    if(el) el.textContent = v[k] + (k.includes('ONS') ? '' : ' ‚Ç∫');
                });
            });
        }
        setInterval(guncelle, 5000);
        guncelle();
    </script>
</body>
</html>