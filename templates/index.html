<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Berkay Borsa - Canlƒ±</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #0b0e11; color: #eaecef; font-family: 'Segoe UI', sans-serif; padding-top: 50px; }
        .main-card { background-color: #1e2329; border: 1px solid #333; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .price-row { border-bottom: 1px solid #2d333a; padding: 15px 0; display: flex; justify-content: space-between; align-items: center; }
        .price-row:last-child { border-bottom: none; }
        .label-text { font-size: 1.1rem; color: #848e9c; }
        .val-text { font-size: 1.4rem; font-weight: bold; color: #f0b90b; transition: all 0.5s; }
        .calc-section { background-color: #2b3139; border-radius: 15px; padding: 25px; }
        .form-control { background: #1e2329; border: 1px solid #474d57; color: white; border-radius: 8px; }
        .form-control:focus { background: #1e2329; color: white; border-color: #f0b90b; box-shadow: none; }
        .btn-gold { background-color: #f0b90b; border: none; color: black; font-weight: bold; width: 100%; border-radius: 8px; padding: 10px; margin-top: 10px; }
        .btn-gold:hover { background-color: #d8a608; }
        .flash-up { color: #00ff00 !important; }
    </style>
</head>
<body>

<div class="container">
    <div class="main-card p-5">
        <h2 class="text-center mb-5" style="letter-spacing: 2px;">BERKAY <span style="color:#f0b90b">BORSA</span></h2>

        <div class="row g-5">
            <div class="col-md-6 order-md-1 order-2">
                <div class="calc-section">
                    <h4 class="mb-4 text-center">Hƒ±zlƒ± √áevirici</h4>

                    <div class="mb-4">
                        <label class="form-label small text-muted">Dolar Miktarƒ± (USD)</label>
                        <input type="number" id="inp-usd" class="form-control" placeholder="√ñrn: 100">
                        <button class="btn btn-gold" onclick="calcUsd()">DOLAR HESAPLA</button>
                        <p id="res-usd" class="mt-2 text-center fw-bold text-warning"></p>
                    </div>

                    <div class="mb-2">
                        <label class="form-label small text-muted">Altƒ±n Miktarƒ± (Gram)</label>
                        <input type="number" id="inp-gram" class="form-control" placeholder="√ñrn: 10">
                        <button class="btn btn-gold" onclick="calcGram()">ALTIN HESAPLA</button>
                        <p id="res-gram" class="mt-2 text-center fw-bold text-warning"></p>
                    </div>
                </div>
            </div>

            <div class="col-md-6 order-md-2 order-1">
                <h4 class="mb-4 text-white-50 text-center text-md-start">Anlƒ±k Veriler</h4>
                <div class="price-row">
                    <span class="label-text">üá∫üá∏ Dolar (USD)</span>
                    <span class="val-text" id="v-USD">{{ kurlar.USD }} ‚Ç∫</span>
                </div>
                <div class="price-row">
                    <span class="label-text">üá™üá∫ Euro (EUR)</span>
                    <span class="val-text" id="v-EUR">{{ kurlar.EUR }} ‚Ç∫</span>
                </div>
                <div class="price-row">
                    <span class="label-text">üü° Gram Altƒ±n</span>
                    <span class="val-text" id="v-GRAM">{{ altin_fiyatlari.GRAM }} ‚Ç∫</span>
                </div>
                <div class="price-row">
                    <span class="label-text">üåç Ons Altƒ±n</span>
                    <span class="val-text" id="v-ONS">${{ altin_fiyatlari.ONS }}</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function toNum(txt) {
        return parseFloat(txt.replace(/[^\d,]/g, '').replace(',', '.'));
    }

    function calcUsd() {
        let m = document.getElementById('inp-usd').value;
        let k = toNum(document.getElementById('v-USD').innerText);
        document.getElementById('res-usd').innerText = (m * k).toLocaleString('tr-TR') + " ‚Ç∫";
    }

    function calcGram() {
        let m = document.getElementById('inp-gram').value;
        let k = toNum(document.getElementById('v-GRAM').innerText);
        document.getElementById('res-gram').innerText = (m * k).toLocaleString('tr-TR') + " ‚Ç∫";
    }

    // 10 Saniyede bir otomatik senkronizasyon
    setInterval(() => {
        fetch('/api/fiyatlar')
            .then(r => r.json())
            .then(data => {
                const sync = (id, val) => {
                    let el = document.getElementById(id);
                    if(el && el.innerText !== val) {
                        el.innerText = val;
                        el.classList.add('flash-up');
                        setTimeout(() => el.classList.remove('flash-up'), 600);
                    }
                }
                sync('v-USD', data.kurlar.USD + " ‚Ç∫");
                sync('v-EUR', data.kurlar.EUR + " ‚Ç∫");
                sync('v-GRAM', data.altin.GRAM + " ‚Ç∫");
                sync('v-ONS', "$" + data.altin.ONS);
            });
    }, 10000);
</script>

</body>
</html>